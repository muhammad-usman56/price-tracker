function formatprice(n) {
  var i = n.toString(),
    f = i.indexOf("."),
    r = i,
    u = 0,
    t;
  if (f > -1) {
    for (t = i.length - 1; t >= 1; t--)
      if (i[t] == "0") {
        if ((u++, i[t - 1] == ".")) {
          u++;
          break;
        }
      } else break;
    for (r = "", t = 0; t < i.length - u; t++) r += i[t];
  }
  return r;
}
function toLocaleString(n, t) {
  (t == null || t == "") && (t = 0);
  var i = n.toLocaleString();
  return -1 == i.lastIndexOf(".")
    ? i
    : t > 0
    ? i.substring(0, i.lastIndexOf(".") + 1 + t)
    : i.substring(0, i.lastIndexOf(".") + t);
}
function toNumberStr(n, t) {
  if (/^(\d+(?:\.\d+)?)(e)([\-]?\d+)$/.test(n)) {
    var i = /^(\d{1,}(?:,\d{3})*\.(?:0*[1-9]+)?)(0*)?$/.exec(n.toFixed(t));
    return i ? i[1] : n.toFixed(t);
  }
  return n.toFixed(t);
}
function format_crypto(n) {
  var i = n < 0 ? !0 : !1,
    t;
  return (
    i && (n = -n),
    (n = parseFloat(n)),
    (n =
      n >= 1e5
        ? toLocaleString(n, 0)
        : n >= 10
        ? toLocaleString(n, 2)
        : n >= 1
        ? toLocaleString(n, 3)
        : n >= 0.1
        ? n.toPrecision(4)
        : n > 0.01
        ? toNumberStr(n, 5)
        : n > 0.0001
        ? toNumberStr(n, 6)
        : n > 1e-6
        ? toNumberStr(n, 8)
        : n > 1e-8
        ? toNumberStr(n, 10)
        : n > 1e-10
        ? toNumberStr(n, 12)
        : n > 1e-12
        ? toNumberStr(n, 14)
        : n > 1e-14
        ? toNumberStr(n, 16)
        : n > 1e-16
        ? toNumberStr(n, 18)
        : toNumberStr(n, 20)),
    (t = formatprice(n)),
    i && (t = "-" + t),
    t
  );
}
function toThousands(n, r) {
  r = r > 0 && r <= 20 ? r : 2;
  n = parseFloat((n + "").replace(/[^\d\.-]/g, "")).toFixed(r) + "";
  var u = n.split(".")[0].split("").reverse(),
    f = n.split(".")[1];
  for (t = "", i = 0; i < u.length; i++)
    t += u[i] + ((i + 1) % 3 == 0 && i + 1 != u.length ? "," : "");
  return t.split("").reverse().join("") + "." + f;
}
function scrollLeft() {
  speed--;
  $(".marquee-preview-right ul").css("left", speed + "px");
  speed <= -ulWidth / 2 &&
    ((speed = 0), $(".marquee-preview-right ul").css("left", 0));
}
function fillPriceMarquee(n) {
  var t = $(".coincarp-marquee"),
    r = t.attr("data-theme"),
    u = t.attr("data-showicon"),
    i = "";
  if (
    (t.html(marqueeDivHtml),
    r == "light" ? t.removeClass("dark-marquee") : t.addClass("dark-marquee"),
    n.forEach(function (n) {
      i +=
        '<li> <a href = "' +
        ccWebsiteUrl +
        "currencies/" +
        n.code +
        '/" target="_blank" >     <div class="li-item-left">';
      u == "true" &&
        (i += ' <img src="' + n.logo + '" width="24" height="24" />');
      i +=
        ' <div class="ml-1">            <span class="name font-weight-bold">' +
        n.name +
        '</span>            <span class="symbol font-weight-bold">' +
        n.symbol +
        '</span>       </div>    </div>         <div class="li-item-right">            <span class="price-num font-weight-bold">' +
        n.quote.symbol +
        format_crypto(n.quote.price) +
        '</span>            <span class="chg font-weight-bold ' +
        (n.changerate >= 0 ? "green" : "red") +
        '">      <i class="icon ' +
        (n.changerate >= 0 ? "iconup" : "icondown") +
        '"></i>' +
        n.changerate +
        "%</span>         </div>   </a></li >";
    }),
    t.find("ul").html(i + i),
    (ulWidth = $(".marquee-preview-right ul").innerWidth()),
    ulWidth > $(".marquee-preview-right").innerWidth() * 2)
  ) {
    timer = setInterval(scrollLeft, 10);
    $(document).on("mouseover", ".marquee-preview-right", function () {
      clearInterval(timer);
    });
    $(document).on("mouseout", ".marquee-preview-right", function () {
      timer = setInterval(scrollLeft, 10);
    });
  } else
    clearInterval(timer),
      $(".marquee-preview-right ul").css("left", 0),
      t.find("ul").html(i);
}
function fillPriceBlocks(n) {
  var t = $(".coincarp-blocks-div"),
    i = t.attr("data-theme"),
    r = t.attr("data-showicon");
  t.html(blocksDivHtml);
  t.find(".blocks-powered").children("div").html(InitBlocksFiatsHtml());
  i == "light" ? t.removeClass("dark-blocks") : t.addClass("dark-blocks");
  n.forEach(function (n) {
    var i = '<div class="blocks-item">';
    r == "true" &&
      (i +=
        ' <div class="img" ><img src="' +
        n.logo +
        '" width="30" height="30" /></div>');
    i +=
      ' <a href="' +
      ccWebsiteUrl +
      "currencies/" +
      n.code +
      '/" class="name" target="_blank">' +
      n.name +
      '</a> <div class="price">' +
      n.quote.symbol +
      format_crypto(n.quote.price) +
      '</div>    <div class="chg" style="background-color:#' +
      (n.changerate >= 0 ? "16c784" : "ea3943") +
      '">      <i class="icon ' +
      (n.changerate >= 0 ? "iconup" : "icondown") +
      '"></i>      <span>' +
      n.changerate +
      "%</span>    </div> </div >";
    t.find(".blocks-list").append(i);
  });
  t.show();
}
function InitBlocksFiatsHtml() {
  var t = $(".coincarp-blocks-div").attr("data-base"),
    n = "";
  return (
    ($.ajaxSettings.async = !1),
    $.getJSON(ccApiHostUrl + "api/v1/market/tools/currency_rate", function (i) {
      var u, r;
      i.code == 200 &&
        ((u = i.data.faits),
        u.length > 0 &&
          ((r = ""),
          (r +=
            '<img src="imgsrc" class="blocks-fiat-icon" width="18" height="18">'),
          (r += "<select>"),
          u.forEach(function (n) {
            r += "<option ";
            t == n.exchange_currency &&
              (r = r.replace("imgsrc", n.logo) + 'selected="" ');
            r +=
              'value="' +
              n.exchange_currency +
              '">' +
              n.exchange_currency.toUpperCase() +
              "</option>";
          }),
          (r += "</select>"),
          (n = r)));
    }),
    n
  );
}
var ccWebsiteUrl = "https://www.coincarp.com/",
  ccApiHostUrl = "https://sapi.coincarp.com/",
  ccStaticHostUrl = "https://s1.coincarp.com/",
  styles = document.createElement("link"),
  script,
  marqueeDivHtml,
  blocksDivHtml,
  timer,
  speed,
  ulWidth;
styles.rel = "styleSheet";
styles.type = "text/css";
styles.href = ccStaticHostUrl + "static/css/widget.min.css?v=1.8";
document.getElementsByTagName("head")[0].appendChild(styles);
script = document.createElement("script");
script.type = "text/javascript";
script.src = ccStaticHostUrl + "static/script/widget/jquery.min.js?v=1.8";
document.getElementsByTagName("head")[0].appendChild(script);
marqueeDivHtml = function () {
  return [
    "<div style='height:30px' class='marquee-preview-left'>",
    "<a href='" + ccWebsiteUrl + "' target='_blank' >",
   
  
    "</a>",
    "</div>",
    "<div class='marquee-preview-right'><ul></ul></div>",
  ].join("");
};
blocksDivHtml = function () {
  return (
    '<div class="blocks-list"></div><div class="blocks-powered">   <div >   </div>   <a href="' +
    ccWebsiteUrl +
    '" target="_blank">             <span class="powered-logo"><span>   </a></div> '
  );
};
speed = 0;
ulWidth = 0;
document.onreadystatechange = function () {
  if (document.readyState == "complete") {
    if (
      (($widgetDiv = $(".coincarp-marquee,.coincarp-blocks-div")),
      $widgetDiv.length == 0)
    )
      return;
    var t = $widgetDiv.attr("data-currencycode"),
      i = $widgetDiv.attr("data-base"),
      n = $widgetDiv.attr("data-type"),
      r =
        ccApiHostUrl +
        "api/v1/market/tools/widget?&code=" +
        t +
        "&convertcode=" +
        i;
    $.getJSON(r, function (t) {
      t.code == 200 &&
        (n == "marquee"
          ? fillPriceMarquee(t.data)
          : n == "blocks" && fillPriceBlocks(t.data));
    });
    $(document).on(
      "change",
      ".coincarp-blocks-div .blocks-powered select",
      function () {
        $widgetDiv = $(".coincarp-blocks-div");
        var t = $widgetDiv.attr("data-currencycode"),
          n = $(this).val(),
          i =
            ccApiHostUrl +
            "api/v1/market/tools/widget?&code=" +
            t +
            "&convertcode=" +
            n;
        $widgetDiv.attr("data-base", n);
        $.getJSON(i, function (n) {
          n.code == 200 && fillPriceBlocks(n.data);
        });
      }
    );
  }
};
